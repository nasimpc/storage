<html>

<body id="a">
    <h1>Form</h1>
    <form onsubmit="saveToLocalStorage(event)">
        <label> Name</label>
        <input id="name" type="text" name="username" required />
        <label> EmailId</label>
        <input id="email" type="email" name="emailId" required />
        <label> Phone Number</label>
        <input id="phno" type="tel" name="phonenumber" />
        <button> Submit </button><br>

    </form>
    <p id="b"></p>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.0/axios.min.js"></script>
    <script>
        var s = 0;
        var oldid;
        var body = document.getElementById('a');
        body.addEventListener('click', removeItem);
        function saveToLocalStorage(e) {
            e.preventDefault();
            const name = event.target.username.value;
            const email = event.target.emailId.value;
            const phonenumber = event.target.phonenumber.value;
            //localStorage.setItem('name', name);
            //localStorage.setItem('email', email);
            //localStorage.setItem('phonenumber', phonenumber);

            const obj = {
                name: name,
                email: email,
                phonenumber: phonenumber
            }
            if (s == 1) {
                s = 0;
                var name1 = document.getElementById('name');
                name1.value = '';
                var email1 = document.getElementById('email');
                email1.value = '';
                var phno1 = document.getElementById('phno');
                phno1.value = '';
                axios.put(`https://crudcrud.com/api/e1804fb96248451a9cd04bf1c2cf5d3a/data2/${oldid}`, obj).then(res => { showNewUserOnScreen(obj, oldid) }).catch(err => { console.log(err) });
            }
            else {
                axios.post("https://crudcrud.com/api/e1804fb96248451a9cd04bf1c2cf5d3a/data2", obj).then(res => { showNewUserOnScreen(res.data) }).catch(err => { console.log(err) });
            }
            //localStorage.setItem(phonenumber, JSON.stringify(obj));
        }
        window.addEventListener("DOMContentLoaded", () => {
            axios.get("https://crudcrud.com/api/e1804fb96248451a9cd04bf1c2cf5d3a/data2").then(res => {
                console.log(res, res.data[0], res.data[0]['phonenumber']);
                for (var i = 0; res.data.length; i++) {

                    showNewUserOnScreen(res.data[i])
                }

            })

            // const localStorageObj = localStorage;
            // const localstoragekeys = Object.keys(localStorageObj)

            // for (var i = 0; i < localstoragekeys.length; i++) {
            //     const key = localstoragekeys[i]
            //     const userDetailsString = localStorageObj[key];
            //     const userDetailsObj = JSON.parse(userDetailsString);
            //     showNewUserOnScreen(userDetailsObj)
            // }
        })
        //show user on screen
        function showNewUserOnScreen(obj, id = '1qazx234rfvrrf') {
            if (obj['_id']) {
                id = obj['_id']
            }
            var newText = document.createTextNode(obj['name'] + ' ' + obj['email'] + ' ' + obj["phonenumber"] + ' ' + id + ' ');

            // Add text to div
            var a = document.querySelector('#a');
            var b = document.querySelector('#b');
            linebreak = document.createElement("br");
            var div = document.createElement('div');
            div.appendChild(newText);
            //a.insertBefore(newText, b);
            //delete btn
            var deleteBtn = document.createElement('button');
            var editBtn = document.createElement('button');
            deleteBtn.className = 'btn btn-sm float-right delete';
            editBtn.className = 'btn btn-sm float-right';
            deleteBtn.appendChild(document.createTextNode('X'));
            editBtn.appendChild(document.createTextNode('Edit'));
            //a.insertBefore(deleteBtn, b);
            div.appendChild(editBtn);
            div.appendChild(deleteBtn);
            //a.insertBefore(linebreak, b);
            div.appendChild(linebreak);
            a.insertBefore(div, b);
        }
        // Remove item
        function removeItem(e) {
            if (e.target.classList.contains('delete')) {
                if (confirm('Are You Sure?')) {
                    var div = e.target.parentElement;
                    body.removeChild(div);
                    console.log(div);
                    var words = div.firstChild.wholeText;

                    var n = words.split(" ");
                    console.log(n[n.length - 2]);
                    var id = n[n.length - 2];
                    axios.delete(`https://crudcrud.com/api/e1804fb96248451a9cd04bf1c2cf5d3a/data2/${id}`);
                    //localStorage.removeItem(n[n.length - 2]);
                }
            }
            else if (e.target.classList.contains('btn-sm')) {
                var div = e.target.parentElement;
                body.removeChild(div);
                console.log(div);
                var words = div.firstChild.wholeText;

                var n = words.split(" ");
                //console.log(n[n.length - 2]);
                localStorage.removeItem(n[n.length - 2]);
                var name = document.getElementById('name');
                name.value = n[0];
                var email = document.getElementById('email');
                email.value = n[1];
                var phno = document.getElementById('phno');
                phno.value = n[2];
                s = 1;
                oldid = n[n.length - 2];
                //var id = n[n.length - 2];
                // axios.put(`https://crudcrud.com/api/5de19888f54c4a5a9765d1627b28a222/data1/${id}`, {
                //     name: name,
                //     email: email,
                //     phonenumber: phno
                // });


            }

        }

    </script>
</body>

</html>